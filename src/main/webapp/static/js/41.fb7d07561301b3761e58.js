webpackJsonp([41],{cWAs:function(e,t,i){var o=i("nNkq");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);i("rjj0")("fa3a719e",o,!0)},nNkq:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.repeatFiles[data-v-9dc6b834] {\n  border: 1px solid #eee;\n  margin-top: 20px;\n}\n.notCommit[data-v-9dc6b834] {\n  color: #909399;\n}\n.auditing[data-v-9dc6b834] {\n  color: #409eff;\n}\n.pass[data-v-9dc6b834] {\n  color: #67c23a;\n}\n.reject[data-v-9dc6b834] {\n  color: #f56c6c;\n}\n",""])},"oG5+":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("mvHQ"),a=i.n(o),l=i("//Fk"),s=i.n(l),n=i("I1uT"),r=i("rV10"),d=i("XlQU"),c=i("vLgD"),u=i("JSQk"),p=i.n(u),f=i("pxDI"),h=i("mw3O"),m=i.n(h),v={name:"comFileManage",props:{selectCompId:{type:String},selectCompName:{type:String},forUse:{type:String,default:"normal"},proClass:{type:Number}},data:function(){return{username:"",showUploadBtn:!1,ip:"",port:"",userId:"",projectId:"",componentId:"",parentNodeId:"",newFolderName:"",selectFileId:"",errorMessage:"操作失败",maniType:"",fileRename:{name:""},fileEditInfo:{secretClass:null,type:null,productNo:null,fileNo:null},fileUpInfo:{secretClass:null,type:null,productNo:null,fileNo:null},secretClassOptions:[{label:"公开",value:0},{label:"内部",value:1},{label:"秘密",value:2},{label:"机密",value:3}],typeOptions:[{label:"参数文件",value:"0"},{label:"模型文件",value:"1"},{label:"报告文件",value:"2"},{label:"实验数据",value:"3"}],codeNameOptions:[{label:"产品型号",value:0},{label:"文件图号",value:1}],uploadDialog:!1,renameDialog:!1,maniFileDialog:!1,editInfoDialog:!1,fileList:[],breadcrumbList:[],tableKey:0,list:[],listApproved:[],allFileList:[],singleComp:null,total:null,listLoading:!0,approveListLoading:!0,uploading:!1,upFileLoading:!1,fileRenameRules:{name:[{required:!0,message:"请输入文件名！",trigger:"blur"}]},maniFileLoading:!1,options:{target:"http://127.0.0.1:8080/files/chunks",headers:{Authorization:""},chunkSize:52428800,simultaneousUploads:20,autoStart:!1,testChunks:!0,singleFile:!0},attrs:{accept:"image/*"},statusText:{computeMD5:"正在计算MD5",success:"上传结束",error:"出错了",uploading:"上传中",paused:"暂停中",waiting:"等待中"},md5Loading:!1,started:!1,autoStart:!1,files:[],fileInfo:[],searchQuery:"",target:"",token:"",fileInfoList:[],fileCompleteLength:0,stopResolveMD5:!1,hiddenClose:!1,libOptions:[],selectedFiles:[],selectedFileIds:[],commitDialog:!1,signType:0,activeNames:"",getMaLoading:!1,userList:[],countersignList:[],verifyMembers:[],auditMembers:[],signMembers:[],approveMembers:[],repeatFiles:[],filiterStateList:[{text:"未提交",value:"notCommit"},{text:"审核中",value:"auditing"},{text:"审核通过",value:"pass"},{text:"审核驳回",value:"deny"}],uploadType:"normal",selectedFileId:"",versionOptions:[{value:"M"},{value:"C"},{value:"S"},{value:"D"}],ifToStartOptions:[{label:"提交到初始审核流程",value:!0},{label:"提交到被驳回的审核流程",value:!1}],fileModify:{version:"",versionNum:1,ifToStart:null},currentVersion:"",versionSelectDialog:!1,switchVersion:"",switchVersionOptions:[],commitLoading:!1,targetEditFile:{},showOnlyEdit:!1}},created:function(){this.username=this.getCookie("username"),this.ip=this.getCookie("ip"),this.port=this.getCookie("port"),this.userId=this.getCookie("userId"),this.target=c.a.defaults.baseURL+"/files/chunks",this.token="Bearer"+this.$store.getters.token,this.selectFileId="",this.maniType="",this.initData()},methods:{refreshFileList:function(){var e=this;this.showUploadBtn=!1,Object(r.l)(this.componentId,!0).then(function(t){0===t.data.code&&(e.listApproved=t.data.data,e.approveListLoading=!1,Object(r.l)(e.componentId,!1).then(function(t){0===t.data.code&&(e.list=t.data.data,e.listLoading=!1,e.allFileList=e.listApproved.concat(e.list),0===e.allFileList.length&&(e.showUploadBtn=!0))}).catch(function(){e.listLoading=!1,e.$notify({title:"失败",message:"加载出错！",type:"error",duration:2e3})}))}).catch(function(){e.approveListLoading=!1,e.$notify({title:"失败",message:"加载出错！",type:"error",duration:2e3})})},getAbleUser:function(){var e=this;this.getMaLoading=!0,Object(d.d)().then(function(t){if(0===t.data.code){e.userList=[],t.data.data.forEach(function(t){"admin"!==t.username&&"securityGuard"!==t.username&&"securityAuditor"!==t.username&&e.userList.push(t)}),e.countersignList=e.userList.slice(0);for(var i=0;i<e.countersignList.length;i++)if(e.countersignList[i].id===e.userId){e.countersignList.splice(i,1);break}e.getMaLoading=!1}else e.getMaLoading=!1}).catch(function(){e.getMaLoading=!1})},initData:function(){this.projectId=this.$store.getters.projectId,this.componentId=this.selectCompId,this.compName=this.selectCompName,this.breadcrumbList=[],this.list=[],this.breadcrumbList.push({name:this.compName,componentId:this.componentId,parentNodeId:"",folder:!0}),this.componentId?this.getList():this.listLoading=!1,this.autoStart=!1},getList:function(){var e=this;this.listLoading=!0,this.showUploadBtn=!1,Object(r.l)(this.componentId,!0).then(function(t){0===t.data.code&&(e.listApproved=t.data.data,e.approveListLoading=!1,Object(r.l)(e.componentId,!1).then(function(t){0===t.data.code&&(e.list=t.data.data,e.listLoading=!1,e.allFileList=e.listApproved.concat(e.list),0===e.allFileList.length&&(e.showUploadBtn=!0))}).catch(function(){e.listLoading=!1,e.$notify({title:"失败",message:"加载出错！",type:"error",duration:2e3})}))}).catch(function(){e.approveListLoading=!1,e.$notify({title:"失败",message:"加载出错！",type:"error",duration:2e3})})},handleuploadFile:function(){var e=this;this.uploadType="normal",this.uploadDialog=!0,this.hiddenClose=!1,this.$nextTick(function(){e.fileReader=new FileReader,e.$refs.uploader.uploader.cancel(),e.$refs.uploader.uploader.opts.target=e.target,e.$refs.uploader.uploader.opts.headers.Authorization=e.token,e.$refs.uploader.uploader.opts.singleFile=!0,$(".uploader-list ul").html(""),e.fileCompleteLength=0,e.fileInfoList=[],$(".manage-uploader .uploader-btn").css("display","inline-block")})},handleEditFile:function(e,t){var i=this;this.selectedFileId=e.id,this.uploadType=t,this.showOnlyEdit=!0,this.currentVersion=e.version,this.targetEditFile=e,this.uploadDialog=!0,this.hiddenClose=!1,this.$nextTick(function(){i.fileReader=new FileReader,i.$refs.uploader.uploader.cancel(),i.$refs.uploader.uploader.opts.target=i.target,i.$refs.uploader.uploader.opts.headers.Authorization=i.token,i.$refs.uploader.uploader.opts.singleFile=!0,$(".uploader-list ul").html(""),i.fileCompleteLength=0,i.fileInfoList=[],$(".manage-uploader .uploader-btn").css("display","inline-block")})},checkMd5:function(e,t){var i=this;if(this.showOnlyEdit=!1,"normal"===this.uploadType){this.repeatFiles=[];for(var o=e.length-1;o>=0;o--)for(var a=0;a<this.list.length;a++)if(void 0===e[o]||e[o].name!==this.list[a].name+"."+this.list[a].postfix);else{var l=e[o];this.repeatFiles.push(l),this.$refs.uploader.uploader.removeFile(l),this.fileCompleteLength+=1,e.splice(o,1)}}this.repeatFiles.length>0&&this.$message({showClose:!0,message:"请注意，此次上传的文件中有"+this.repeatFiles.length+"个文件在库中已存在！",type:"warning"}),e.length>0&&(this.hiddenClose=!0,this.md5Loading=!0,$(".manage-uploader .uploader-btn").css("display","none")),this.fileCompleteLength+=e.length;for(var s=this.$refs.uploader.uploader.opts.chunkSize,n=0,r=this,d=function(){var t=e[c];i.resolveMd5(t,s).then(function(i){t.md5=i,t.uniqueIdentifier=i,Object(f.a)(t.md5).then(function(i){if(i.data.data.id){n++;var o={fileId:i.data.data.id,MD5:t.md5,name:t.name,relativePath:"/"+t.relativePath,secretClass:r.fileUpInfo.secretClass,type:r.fileUpInfo.type,productNo:r.fileUpInfo.productNo,fileNo:r.fileUpInfo.fileNo,sublibraryId:r.fileUpInfo.subLibraryId};r.fileInfoList.push(o);var a="",l=t.size;l<1024?a=l+" B":l>=1024&&l<1048576?a=Math.round(l/1024*10)/10+" KB":l>=1048576&&l<1073741824?a=Math.round(l/1048576*10)/10+" MB":l>=1073741824&&(a=Math.round(l/1073741824*10)/10+" G"),$(".manage-uploader .uploader-list ul").prepend('<div status="success" class="uploader-file"><div class="uploader-file-progress" style="transform: translateX(0%);"></div> <div class="uploader-file-info"><div class="uploader-file-name"><i icon="unknown" class="uploader-file-icon"></i>'+t.name+'</div> <div class="uploader-file-size">'+a+'</div> <div class="uploader-file-meta"></div> <div class="uploader-file-status"><span>成功了</span> <span style="display: none;"><span>100%</span> <em>0 bytes / s</em> <i></i></span></div> <div class="uploader-file-actions"><span class="uploader-file-pause"></span> <span class="uploader-file-resume">️</span> <span class="uploader-file-retry"></span> <span class="uploader-file-remove"></span></div></div></div>'),r.$refs.uploader.uploader.removeFile(t),r.fileCompleteLength+=1,r.listLoading=!1,n===e.length&&(r.md5Loading=!1,r.$refs.uploader.uploader.upload())}else 0==i.data.data&&++n===e.length&&(r.md5Loading=!1,r.$refs.uploader.uploader.upload())})})},c=0;c<e.length;c++)d()},resolveMd5:function(e,t){return new s.a(function(i,o){var a=e.file;if(e.md5)i(e.md5);else{e.status="computeMD5";var l=new p.a,s=new FileReader,n=(File.prototype.slice||File.prototype.mozSlice||File.prototype.webkitSlice,Math.ceil(a.size/t)),r=0;s.onload=function(e){if(l.appendBinary(e.target.result),++r<n){d()}else i(l.end());s.onerror=function(e){return o(e)}};var d=function(){var e=r*t,i=e+t>=a.size?a.size:e+t;s.readAsBinaryString(a.slice(e,i))};d()}})},fileRemove:function(){this.fileCompleteLength-=1},mergeFile:function(e,t,o,a,l){var s=this,n={identifier:e,totalChunks:t,totalSize:o,filename:a,relativePath:l},r=i("mw3O").stringify(n);Object(f.b)(r).then(function(){}).catch(function(){s.$notify({})})},fileSuccess:function(){var e=arguments,t=this,i={identifier:arguments[1].uniqueIdentifier,totalChunks:arguments[1].chunks.length,totalSize:arguments[1].size,filename:arguments[1].name,relativePath:arguments[1].relativePath},o=m.a.stringify(i);this.listLoading=!0,Object(f.b)(o).then(function(i){if(0===i.data.code){var o={fileId:i.data.data.id,MD5:e[1].md5,name:e[1].name,relativePath:"/"+e[1].relativePath,secretClass:t.fileUpInfo.secretClass,type:t.fileUpInfo.type,productNo:t.fileUpInfo.productNo,fileNo:t.fileUpInfo.fileNo,sublibraryId:t.componentId,userId:t.userId};t.fileInfoList.push(o)}else t.$notify({title:"失败",message:"上传出错了！",type:"error",duration:2e3})})},fileComplete:function(){console.log("filecomplete=======")},deleteFile:function(e){var t=this;this.$confirm("确认删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.listLoading=!0,Object(r.c)(e.id).then(function(i){0===i.data.code?(t.getList(),t.$notify({title:"成功",message:e.name+"删除成功",type:"success",duration:2e3})):t.$notify({title:"失败",message:i.data.msg,type:"error",duration:2e3}),t.listLoading=!1}).catch(function(){t.listLoading=!1,t.$notify({title:"失败",message:"删除失败",type:"error",duration:2e3})})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},previewFile:function(e){var t=this;Object(n.h)(e.id).then(function(e){if(0===e.data.code){if("picture"===e.data.data.fileType){var i=t.$router.resolve({path:"/preview",query:{id:e.data.data.pathId,type:e.data.data.fileType}}).href;window.open(i,"_blank")}if("office"===e.data.data.fileType){var o=c.a.defaults.baseURL+"/preview/viewer/document/"+e.data.data.pathId;window.open(o,"_blank")}}else t.$notify({title:"失败",message:e.data.msg,type:"error",duration:2e3})})},exportFile:function(e){var t=c.a.defaults.baseURL+"/sublibraryFiles/"+e.id+"/user/"+this.userId+"/export";window.open(t)},handleEditInfo:function(e){this.editInfoDialog=!0,this.selectFileId=e.id,this.fileEditInfo={secretClass:e.secretClass,type:e.type,codeName:e.codeName,productNo:e.productNo,fileNo:e.fileNo}},editFileInfo:function(){var e=this,t={secretClass:this.fileEditInfo.secretClass,type:this.fileEditInfo.type,productNo:this.fileEditInfo.productNo,fileNo:this.fileEditInfo.fileNo},o=i("mw3O").stringify(t);Object(r.d)(this.selectFileId,o).then(function(t){0===t.data.code?(e.$notify({title:"成功",message:"文件信息修改成功！",type:"success",duration:2e3}),e.editInfoDialog=!1,e.getList()):e.$notify({title:"失败",message:t.data.msg,type:"error",duration:2e3})})},onSubLibChange:function(e){this.fileUpInfo.subLibraryId=e[1]},handleSelectionChange:function(e){this.selectedFiles=e},handleVerifySelectionChange:function(e){this.verifyMembers=e},handleAuditSelectionChange:function(e){this.auditMembers=e},handleSignSelectionChange:function(e){this.signMembers=e},handleApproveSelectionChange:function(e){this.approveMembers=e},handleCommit:function(){0!==this.selectedFiles.length?(this.commitDialog=!0,this.signType=1,this.getAbleUser()):this.$message({message:"请先选择文件！",type:"warning"})},commitToAuditor:function(){var e=this,t=[],o=[],a=[],l=[],s=[];this.verifyMembers.forEach(function(e){t.push(e.id)}),this.auditMembers.forEach(function(e){o.push(e.id)}),this.signMembers.forEach(function(e){a.push(e.id)}),this.approveMembers.forEach(function(e){l.push(e.id)}),this.selectedFiles.forEach(function(e){s.push(e.id)});var n=(t+"").replace(/\[|]/g,""),d=(o+"").replace(/\[|]/g,""),c=(a+"").replace(/\[|]/g,""),u=(l+"").replace(/\[|]/g,""),p=(s+"").replace(/\[|]/g,""),f=i("mw3O"),h={sublibraryFileId:p,proofreadUserIds:n,auditUserIds:d,countersignUserIds:1===this.signType?"":c,approveUserIds:u,auditMode:this.signType},m=f.stringify(h);this.commitLoading=!0,Object(r.q)(this.selectedId,m).then(function(t){0===t.data.code?(e.$notify({title:"成功",message:"设置成功",type:"success",duration:2e3}),e.commitDialog=!1,e.getList(),e.selectedFiles=[]):e.$notify({title:"失败",message:t.data.msg,type:"error",duration:2e3}),e.commitLoading=!1}).catch(function(){e.$notify({title:"失败",message:"提交失败",type:"error",duration:2e3}),e.commitLoading=!1})},fileAuditSelection:function(e){return 0!==e.auditMode?0:1},getRowKey:function(e){return e.id},filterState:function(e,t){return"notCommit"==e?0===t.auditMode&&0===t.state:"auditing"==e?0!==t.auditMode&&!1===t.ifApprove&&!1===t.ifReject:"pass"==e?!0===t.ifApprove:"deny"==e?!0===t.ifReject:void 0},applyToEdit:function(e){var t=this;this.$confirm("确认申请修改吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var o={userId:t.userId},a=i("mw3O").stringify(o);Object(r.a)(e.id,a).then(function(e){0===e.data.code?(t.$notify({title:"成功",message:"申请成功！",type:"success",duration:"2000"}),t.getList()):t.$notify({title:"失败",message:e.data.msg,type:"error",duration:"2000"})})}).catch(function(){t.$message({type:"info",message:"已取消操作"})})},handleRevoke:function(e){var t=this;this.$confirm("确认撤销上次的修改吗吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Object(r.o)(e.id).then(function(e){0===e.data.code?(t.getList(),t.$notify({title:"成功",message:"撤销",type:"success",duration:2e3})):t.$notify({title:"失败",message:e.data.msg,type:"error",duration:2e3})}).catch(function(){t.$notify({title:"失败",message:"删除失败",type:"error",duration:2e3})})}).catch(function(){t.$message({type:"info",message:"已取消撤销操作"})})},handleRevokeSecond:function(e){var t=this;this.selectFileId=e.id,this.switchVersion="",this.currentVersion=e.version,Object(r.i)(e.id).then(function(e){0===e.data.code&&(t.switchVersionOptions=e.data.data,t.versionSelectDialog=!0)})},revokeSecondEdit:function(){var e=this,t={version:this.switchVersion},o=i("mw3O").stringify(t);Object(r.s)(this.selectFileId,o).then(function(t){0===t.data.code?(e.getList(),e.$notify({title:"成功",message:"版本更新成功",type:"success",duration:2e3})):e.$notify({title:"失败",message:t.data.msg,type:"error",duration:2e3})}).catch(function(){e.$notify({title:"失败",message:"删除失败",type:"error",duration:2e3})})},onlyModifyFileInfo:function(){var e=this;this.$confirm("确认仅修改文件信息吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={fileId:e.targetEditFile.files.id,MD5:e.targetEditFile.files.md5,name:e.targetEditFile.name,relativePath:"/"+e.targetEditFile.name+"."+e.targetEditFile.postfix,secretClass:e.fileUpInfo.secretClass,type:e.fileUpInfo.type,productNo:e.fileUpInfo.productNo,fileNo:e.fileUpInfo.fileNo,sublibraryId:e.targetEditFile.subDepot.id};"edit"===e.uploadType&&(t.ifDirectModify=!0,t.ifBackToStart=e.fileModify.ifToStart,t.version=""),"secondEdit"===e.uploadType&&(item.ifDirectModify=!1,item.ifBackToStart=!0,item.version=e.fileModify.version);var i=a()(t);Object(r.n)(e.selectedFileId,i).then(function(t){0===t.data.code?e.$notify({title:"成功",message:"文件信息修改并提交成功",type:"success",duration:2e3}):e.$notify({title:"失败",message:t.data.msg,type:"error",duration:2e3}),e.uploadDialog=!1}).catch(function(){e.$notify({title:"失败",message:"文件信息修改失败",type:"error",duration:2e3})})})}},computed:{classifyIcon:function(){return function(e){return 1==e.folder?"folder":"png"===e.files.type||"jpg"===e.files.type||"gif"===e.files.type?"image":"rar"===e.files.type||"zip"===e.files.type?"compressed":"file"}},computedSize:function(){return function(e){var t=void 0;return e<1024?t=e+"B":e>=1024&&e<1048576?t=Math.round(e/1024*10)/10+"KB":e>=1048576&&e<1073741824?t=Math.round(e/1048576*10)/10+"MB":e>=1073741824&&(t=Math.round(e/1073741824*10)/10+"G"),t}},computedSecret:function(){return function(e){return 0===e?"公开":1===e?"内部":2===e?"秘密":3===e?"机密":4===e?"绝密":void 0}},fileInfoListLength:function(){return this.fileInfoList.length},computeList:function(){return 3===this.signType?this.countersignList:this.userList},computeAuditState:function(){return function(e){return 0===e.auditMode&&0===e.state?"未提交":0!==e.auditMode&&!1===e.ifApprove&&!1===e.ifReject&&8!==e.state||1===e.state?"审批中":!0===e.ifApprove&&6===e.state?"已通过":!0===e.ifReject&&6===e.state?"已驳回":7===e.state?"修改申请中":8===e.state?"二次修改中":9===e.state?"二次修改中":10===e.state?"二次修改审批中":void 0}},computeStateClass:function(){return function(e){return 0===e.auditMode&&0===e.state?"notCommit":0!==e.auditMode&&!1===e.ifApprove&&!1===e.ifReject?"auditing":!0===e.ifApprove?"approve":!0===e.ifReject?"reject":void 0}},computeVersionOption:function(){if("secondEdit"===this.uploadType){var e=[];if(this.currentVersion.length>0){var t=this.currentVersion.substring(0,1),i=void 0;return!0===this.targetEditFile.ifApprove?(i=parseInt(this.currentVersion.substring(1,this.currentVersion.length))+1,"M"===t&&(e=[{value:"M"+i},{value:"C1"}]),"C"===t&&(e=[{value:"C"+i},{value:"S1"}]),"S"===t&&(e=[{value:"S"+i},{value:"D1"}]),"D"===t&&(e=[{value:"D"+i}])):(i=parseInt(this.currentVersion.substring(1,this.currentVersion.length)),"M"===t&&(e=[{value:"M"+i}]),"C"===t&&(e=[{value:"C"+i}]),"S"===t&&(e=[{value:"S"+i}]),"D"===t&&(e=[{value:"D"+i}])),e}}},computeBtnDisable:function(){return function(e,t){var i=e.state,o=e.ifApprove,a=e.ifReject;return"delete"===t||"modifyInfo"===t?!(0===i&&0===e.auditMode||5===i&&!0!==o||7===i):"edit"===t?5!==i||!0!==a:"apply"===t?5!==i:"secondEdit"===t?7!==i:"revoke"===t?(5!==i||!0!==a)&&7!==i:"changeVersion"===t?(5!==i||!0!==a)&&7!==i:void 0}}},watch:{selectCompId:function(e,t){this.componentId=this.selectCompId,this.parentNodeId="",this.componentId&&this.initData()},selectCompName:function(e,t){this.componentId=this.selectCompId,this.parentNodeId="",this.componentId&&this.initData()},fileInfoListLength:function(e,t){var i=this;if(this.fileCompleteLength===this.fileInfoList.length&&0!==this.fileInfoList.length){var o=a()(this.fileInfoList);if(this.statusText.success="正在合并文件","normal"===this.uploadType)Object(r.r)(this.componentId,this.userId,o).then(function(e){0===e.data.code?(i.$notify({title:"成功",message:"上传成功",type:"success",duration:2e3}),i.statusText.success="文件合并成功"):(i.$notify({title:"成功",message:e.data.msg,type:"error",duration:2e3}),i.statusText.success="文件合并失败"),i.listLoading=!1,i.hiddenClose=!1,i.getList()}).catch(function(){i.listLoading=!1,i.hiddenClose=!1,i.$notify({title:"失败",message:"文件上传时出错",type:"error",duration:2e3}),i.statusText.success="文件合并失败",i.getList()});else if("secondEdit"===this.uploadType){this.fileInfoList.forEach(function(e){e.ifDirectModify=!1,e.ifBackToStart=!0,e.version=i.fileModify.version});var l=a()(this.fileInfoList[0]);Object(r.n)(this.selectedFileId,l).then(function(e){0===e.data.code?(i.$notify({title:"成功",message:"修改成功",type:"success",duration:2e3}),i.statusText.success="文件修改成功"):(i.$notify({title:"成功",message:e.data.msg,type:"error",duration:2e3}),i.statusText.success="文件修改失败"),i.listLoading=!1,i.hiddenClose=!1,i.getList()}).catch(function(){i.listLoading=!1,i.hiddenClose=!1,i.$notify({title:"失败",message:"文件修改时出错",type:"error",duration:2e3}),i.statusText.success="文件修改失败",i.getList()})}else if("edit"===this.uploadType){this.fileInfoList.forEach(function(e){e.ifDirectModify=!0,e.ifBackToStart=i.fileModify.ifToStart,e.version=""});var s=a()(this.fileInfoList[0]);Object(r.n)(this.selectedFileId,s).then(function(e){0===e.data.code?(i.$notify({title:"成功",message:"修改成功",type:"success",duration:2e3}),i.statusText.success="文件修改成功"):(i.$notify({title:"成功",message:e.data.msg,type:"error",duration:2e3}),i.statusText.success="文件修改失败"),i.listLoading=!1,i.hiddenClose=!1,i.getList()}).catch(function(){i.listLoading=!1,i.hiddenClose=!1,i.$notify({title:"失败",message:"文件修改时出错",type:"error",duration:2e3}),i.statusText.success="文件修改失败",i.getList()})}}}}},g={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"fileComp"},["preview"!==e.forUse?i("div",{staticClass:"operationContainer",staticStyle:{position:"relative",height:"40px","border-bottom":"1px solid #ebeef5"}},[i("div",{staticStyle:{position:"absolute",top:"-6px",left:"16px"}},[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleCommit}},[e._v("提交审核")])],1),e._v(" "),"admin"===e.username&&e.showUploadBtn?i("div",{staticStyle:{float:"right",color:"rgb(0, 171, 235)",cursor:"pointer","padding-right":"20px"}},[i("span",{on:{click:e.handleuploadFile}},[i("svg-icon",{attrs:{"icon-class":"upload1"}}),e._v(" "),i("span",{staticStyle:{"font-size":"14px","margin-left":"6px"}},[e._v("上传文件")])],1)]):e._e()]):e._e(),e._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],key:e.tableKey,staticStyle:{width:"100%"},attrs:{data:e.allFileList,"element-loading-text":"正在加载库文件",fit:"","highlight-current-row":"","row-key":e.getRowKey,height:"700px"},on:{"selection-change":e.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",selectable:e.fileAuditSelection,"reserve-selection":!0,width:"55"}}),e._v(" "),i("el-table-column",{attrs:{label:"文件名","min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[i("svg-icon",{staticStyle:{"font-size":"30px","margin-right":"10px",cursor:"pointer",color:"#26bada"},attrs:{"icon-class":e.classifyIcon(t.row)}}),e._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.row.name,placement:"top"}},[t.row.newFolder?e._e():i("span",{staticClass:"link-type",class:{repeatFile:t.row.repeat},staticStyle:{position:"relative",top:"2px",display:"inline-block",width:"70%","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"}},[e._v("\n              "+e._s(t.row.name)+"\n            ")])])],1)]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"种类",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[!0===t.row.folder||t.row.newFolder?e._e():i("span",[e._v("\n          "+e._s(t.row.files.postfix)+"\n        ")]),e._v(" "),1!=t.row.folder||t.row.newFolder?e._e():i("span",[e._v("\n          文件夹\n        ")])]}}])}),e._v(" "),i("el-table-column",{attrs:{width:"120",label:e.$t("table.compSize")},scopedSlots:e._u([{key:"default",fn:function(t){return[!0!==t.row.folder?i("span",[e._v(e._s(e.computedSize(t.row.files.fileSize)))]):e._e(),e._v(" "),!0===t.row.folder&&t.row.name?i("span",[e._v("--")]):e._e(),e._v(" "),t.row.newFolder?i("span",{staticStyle:{cursor:"pointer"},on:{click:e.cancelNewFolder}},[i("svg-icon",{attrs:{"icon-class":"cancel"}})],1):e._e()]}}])}),e._v(" "),i("el-table-column",{attrs:{width:"120",label:"密级"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(e.computedSecret(t.row.secretClass)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{width:"120",label:"版本"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.version))])]}}])}),e._v(" "),i("el-table-column",{attrs:{width:"180",label:"创建时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",[e._v(e._s(t.row.createTime))])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"审核状态",width:"100",align:"center",filters:e.filiterStateList,"filter-method":e.filterState,prop:"state"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{class:e.computeStateClass(t.row)},[e._v("\n          "+e._s(e.computeAuditState(t.row))+"\n        ")])]}}])}),e._v(" "),i("el-table-column",{attrs:{width:"40px"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.name?i("el-dropdown",{attrs:{trigger:"click"}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"更多操作",placement:"top"}},[i("span",{staticClass:"el-dropdown-link"},[i("svg-icon",{attrs:{"icon-class":"ellipsis"}})],1)]),e._v(" "),"preview"===e.forUse?i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",[i("span",{staticStyle:{display:"inline-block",padding:"0 10px"},on:{click:function(i){e.previewFile(t.row)}}},[e._v("预览")])])],1):i("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[i("el-dropdown-item",{attrs:{disabled:e.computeBtnDisable(t.row,"delete")}},[i("span",{staticStyle:{display:"inline-block",padding:"0 10px"},on:{click:function(i){e.deleteFile(t.row)}}},[e._v("删除")])]),e._v(" "),i("el-dropdown-item",{attrs:{divided:"",disabled:e.computeBtnDisable(t.row,"download")}},[i("span",{staticStyle:{display:"inline-block",padding:"0 10px"},on:{click:function(i){e.exportFile(t.row)}}},[e._v("下载")])]),e._v(" "),i("el-dropdown-item",{attrs:{divided:"",disabled:e.computeBtnDisable(t.row,"modifyInfo")}},[i("span",{staticStyle:{display:"inline-block",padding:"0 10px"},on:{click:function(i){e.handleEditInfo(t.row)}}},[e._v("修改文件信息")])]),e._v(" "),i("el-dropdown-item",{attrs:{divided:""}},[i("span",{staticStyle:{display:"inline-block",padding:"0 10px"},on:{click:function(i){e.applyToEdit(t.row)}}},[e._v("申请二次修改")])]),e._v(" "),i("el-dropdown-item",{attrs:{divided:"",disabled:e.computeBtnDisable(t.row,"secondEdit")}},[i("span",{staticStyle:{display:"inline-block",padding:"0 10px"},on:{click:function(i){e.handleEditFile(t.row,"secondEdit")}}},[e._v("二次修改文件")])]),e._v(" "),i("el-dropdown-item",{attrs:{divided:"",disabled:e.computeBtnDisable(t.row,"revoke")}},[i("span",{staticStyle:{display:"inline-block",padding:"0 10px"},on:{click:function(i){e.handleRevoke(t.row)}}},[e._v("撤销修改")])]),e._v(" "),i("el-dropdown-item",{attrs:{divided:"",disabled:e.computeBtnDisable(t.row,"changeVersion")}},[i("span",{staticStyle:{display:"inline-block",padding:"0 10px"},on:{click:function(i){e.handleRevokeSecond(t.row)}}},[e._v("更换版本")])])],1)],1):e._e()]}}])})],1),e._v(" "),i("el-dialog",{staticClass:"uploadDialog",attrs:{title:"上传文件",visible:e.uploadDialog,"close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,"append-to-body":"",width:"50%"},on:{"update:visible":function(t){e.uploadDialog=t}}},[i("el-form",{attrs:{"label-position":"left","label-width":"70px"}},[i("el-form-item",{attrs:{label:"密级"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择密级"},model:{value:e.fileUpInfo.secretClass,callback:function(t){e.$set(e.fileUpInfo,"secretClass",t)},expression:"fileUpInfo.secretClass"}},e._l(e.secretClassOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"类型"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择类型"},model:{value:e.fileUpInfo.type,callback:function(t){e.$set(e.fileUpInfo,"type",t)},expression:"fileUpInfo.type"}},e._l(e.typeOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"产品型号"}},[i("el-input",{attrs:{placeholder:"请输入产品型号"},model:{value:e.fileUpInfo.productNo,callback:function(t){e.$set(e.fileUpInfo,"productNo",t)},expression:"fileUpInfo.productNo"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"文件图号"}},[i("el-input",{attrs:{placeholder:"请输入文件图号"},model:{value:e.fileUpInfo.fileNo,callback:function(t){e.$set(e.fileUpInfo,"fileNo",t)},expression:"fileUpInfo.fileNo"}})],1)],1),e._v(" "),"secondEdit"===e.uploadType?i("el-form",{attrs:{"label-position":"left","label-width":"70px"}},[i("el-form-item",{attrs:{label:"版本号"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择版本号"},model:{value:e.fileModify.version,callback:function(t){e.$set(e.fileModify,"version",t)},expression:"fileModify.version"}},e._l(e.computeVersionOption,function(e){return i("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})}))],1)],1):e._e(),e._v(" "),"edit"===e.uploadType?i("el-form",{attrs:{"label-position":"left","label-width":"70px"}},[i("el-form-item",{attrs:{label:"审批流程"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择提交的目标审批流程"},model:{value:e.fileModify.ifToStart,callback:function(t){e.$set(e.fileModify,"ifToStart",t)},expression:"fileModify.ifToStart"}},e._l(e.ifToStartOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1)],1):e._e(),e._v(" "),i("uploader",{directives:[{name:"loading",rawName:"v-loading",value:e.md5Loading,expression:"md5Loading"}],ref:"uploader",staticClass:"manage-uploader",attrs:{options:e.options,autoStart:e.autoStart,"file-status-text":e.statusText,"element-loading-text":"正在校验文件身份，请勿关闭"},on:{"file-complete":e.fileComplete,"files-added":e.checkMd5,"file-success":e.fileSuccess,"file-removed":e.fileRemove}},[i("uploader-unsupport"),e._v(" "),i("uploader-drop",[i("p",[e._v("在此处进行操作")]),e._v(" "),null!==e.fileUpInfo.secretClass&&null!==e.fileInfo.type&&null!==e.fileUpInfo.productNo&&null!==e.fileUpInfo.fileNo&&null!==e.fileUpInfo.subLibraryId&&""!==e.fileUpInfo.secretClass&&""!==e.fileInfo.type&&""!==e.fileUpInfo.productNo&&""!==e.fileUpInfo.fileNo&&""!==e.fileUpInfo.subLibraryId?i("uploader-btn",[e._v("选择文件")]):e._e()],1),e._v(" "),i("uploader-list",{ref:"uploaderList"}),e._v(" "),e.repeatFiles.length>0?i("div",{staticClass:"repeatFiles"},[i("el-table",{key:e.tableKey,attrs:{data:e.repeatFiles,"max-height":"300"}},[i("el-table-column",{attrs:{label:"重复文件列表"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{staticStyle:{color:"#e6a23c"}},[e._v(e._s(t.row.name))])]}}])})],1)],1):e._e()],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["normal"!==e.uploadType&&e.showOnlyEdit?i("el-button",{attrs:{type:"primary"},on:{click:e.onlyModifyFileInfo}},[e._v("仅修改信息")]):e._e(),e._v(" "),e.hiddenClose?e._e():i("el-button",{on:{click:function(t){e.uploadDialog=!1}}},[e._v("关 闭")])],1)],1),e._v(" "),i("el-dialog",{staticClass:"maniFileDialog",attrs:{title:"文件信息修改",visible:e.editInfoDialog,"append-to-body":"",width:"30%"},on:{"update:visible":function(t){e.editInfoDialog=t}}},[i("el-form",{attrs:{"label-position":"left","label-width":"70px"}},[i("el-form-item",{attrs:{label:"密级"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择密级"},model:{value:e.fileEditInfo.secretClass,callback:function(t){e.$set(e.fileEditInfo,"secretClass",t)},expression:"fileEditInfo.secretClass"}},e._l(e.secretClassOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"类型"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择类型"},model:{value:e.fileEditInfo.type,callback:function(t){e.$set(e.fileEditInfo,"type",t)},expression:"fileEditInfo.type"}},e._l(e.typeOptions,function(e){return i("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),i("el-form-item",{attrs:{label:"产品型号"}},[i("el-input",{attrs:{placeholder:"请输入产品型号"},model:{value:e.fileEditInfo.productNo,callback:function(t){e.$set(e.fileEditInfo,"productNo",t)},expression:"fileEditInfo.productNo"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"文件图号"}},[i("el-input",{attrs:{placeholder:"请输入文件图号"},model:{value:e.fileEditInfo.fileNo,callback:function(t){e.$set(e.fileEditInfo,"fileNo",t)},expression:"fileEditInfo.fileNo"}})],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.editInfoDialog=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.editFileInfo}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{staticClass:"limit-width-dialog audit-dialog",attrs:{title:"选择审核人",visible:e.commitDialog,"append-to-body":"",width:"60%"},on:{"update:visible":function(t){e.commitDialog=t}}},[i("el-radio-group",{model:{value:e.signType,callback:function(t){e.signType=t},expression:"signType"}},[i("el-radio",{attrs:{label:1}},[e._v("无会签")]),e._v(" "),i("el-radio",{attrs:{label:2}},[e._v("一人会签通过")]),e._v(" "),i("el-radio",{attrs:{label:3}},[e._v("多人会签通过")])],1),e._v(" "),i("el-collapse",{staticClass:"audit-collapse",attrs:{accordion:""},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[i("el-collapse-item",{attrs:{title:"选择核对人",name:"1"}},[i("div",[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.getMaLoading,expression:"getMaLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.userList,"tooltip-effect":"dark"},on:{"selection-change":e.handleVerifySelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{label:"用户名","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.username))]}}])})],1)],1)]),e._v(" "),i("el-collapse-item",{attrs:{title:"选择审核人",name:"2"}},[i("div",[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.getMaLoading,expression:"getMaLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.userList,"tooltip-effect":"dark"},on:{"selection-change":e.handleAuditSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{label:"用户名","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.username))]}}])})],1)],1)]),e._v(" "),2===e.signType||3===e.signType?i("el-collapse-item",{attrs:{title:"选择会签人",name:"3"}},[i("div",[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.getMaLoading,expression:"getMaLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.computeList,"tooltip-effect":"dark"},on:{"selection-change":e.handleSignSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{label:"用户名","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.username))]}}])})],1)],1)]):e._e(),e._v(" "),i("el-collapse-item",{attrs:{title:"选择批准人",name:"4"}},[i("div",[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.getMaLoading,expression:"getMaLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.userList,"tooltip-effect":"dark"},on:{"selection-change":e.handleApproveSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),i("el-table-column",{attrs:{label:"用户名","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.username))]}}])})],1)],1)])],1),e._v(" "),i("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"right"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{staticStyle:{"margin-top":"10px"},attrs:{type:"primary",loading:e.commitLoading},on:{click:e.commitToAuditor}},[e._v("确定")])],1)],1),e._v(" "),i("el-dialog",{staticClass:"selectVersion",attrs:{title:"选择需要回退的版本",visible:e.versionSelectDialog,"append-to-body":"",width:"30%"},on:{"update:visible":function(t){e.versionSelectDialog=t}}},[i("el-form",{attrs:{"label-position":"left","label-width":"70px"}},[i("el-form-item",{attrs:{label:"选择版本"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择回退的版本"},model:{value:e.switchVersion,callback:function(t){e.switchVersion=t},expression:"switchVersion"}},e._l(e.switchVersionOptions,function(e){return i("el-option",{key:e.id,attrs:{label:e.version,value:e.version}})}))],1)],1),e._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.versionSelectDialog=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.revokeSecondEdit}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var y=i("VU/8")(v,g,!1,function(e){i("cWAs")},"data-v-9dc6b834",null);t.default=y.exports}});