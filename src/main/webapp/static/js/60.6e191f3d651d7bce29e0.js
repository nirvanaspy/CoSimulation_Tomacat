webpackJsonp([60],{"5c+R":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("mvHQ"),r=i.n(o),n=i("GLLG"),s={name:"visio",props:{proId:{type:String,default:""},processNodes:{type:Array,default:[]},editable:{type:Boolean,default:!1}},data:function(){return{myDiagram:null,originValue:{class:"go.GraphLinksModel",linkFromPortIdProperty:"fromPort",linkToPortIdProperty:"toPort",nodeDataArray:[{figure:"subtask",key:-1,loc:"-60 130",size:"150 70",text:"结构体建模"},{figure:"subtask",key:-2,loc:"-60 440",size:"150 70",text:"装配仿真"},{figure:"subtask",key:-3,loc:"-60 240",size:"150 70",text:"结构仿真"},{figure:"subtask",key:-4,loc:"-60 340",size:"150 70",text:"力学仿真"},{figure:"subtask",key:-5,loc:"-60 540",size:"150 70",text:"热学仿真"},{figure:"subtask",key:-6,loc:"-60 540",size:"150 70",text:"力学仿真"},{figure:"subtask",key:-7,loc:"-60 540",size:"150 70",text:"热仿真"},{figure:"subtask",key:-8,loc:"-60 540",size:"150 70",text:"电磁仿真"},{figure:"subtask",key:-9,loc:"60 540",size:"150 70",text:"电路建模"},{figure:"subtask",key:-10,loc:"-60 540",size:"150 70",text:"电路仿真"},{figure:"subtask",key:-11,loc:"-60 540",size:"150 70",text:"电磁仿真"}],linkDataArray:[{from:-1,to:-3,fromPort:"B",toPort:"T",points:[]},{from:-3,to:-4,fromPort:"B",toPort:"T",points:[]},{from:-4,to:-2,fromPort:"B",toPort:"T",points:[]},{from:-2,to:-5,fromPort:"B",toPort:"T",points:[]}]},originLink:[]}},methods:{init:function(){var e=this.go,t=e.GraphObject.make;function i(i,o,r,n){return t(e.Shape,"Circle",{fill:null,stroke:null,desiredSize:new e.Size(7,7),alignment:o,alignmentFocus:o,portId:i,fromSpot:o,toSpot:o,fromLinkable:r,toLinkable:n,cursor:"pointer"})}this.myDiagram=t(e.Diagram,"myDiagramDiv",{isReadOnly:!this.editable,grid:t(e.Panel,"Grid",t(e.Shape,"LineH",{stroke:"lightgray",strokeWidth:.5}),t(e.Shape,"LineH",{stroke:"gray",strokeWidth:.5,interval:10}),t(e.Shape,"LineV",{stroke:"lightgray",strokeWidth:.5}),t(e.Shape,"LineV",{stroke:"gray",strokeWidth:.5,interval:10})),InitialLayoutCompleted:function(e){e.diagram.nodes.each(function(e){!0===e.data.pass&&(e.deletable=!1,e.textEditable=!1)}),e.diagram.links.each(function(e){!0===e.data.pass&&(e.deletable=!1,e.textEditable=!1)})},"draggingTool.dragsLink":!0,"draggingTool.isGridSnapEnabled":!0,"linkingTool.isUnconnectedLinkValid":!0,"linkingTool.portGravity":20,"relinkingTool.isUnconnectedLinkValid":!0,"relinkingTool.portGravity":20,"relinkingTool.fromHandleArchetype":t(e.Shape,"Diamond",{segmentIndex:0,cursor:"pointer",desiredSize:new e.Size(8,8),fill:"tomato",stroke:"darkred"}),"relinkingTool.toHandleArchetype":t(e.Shape,"Diamond",{segmentIndex:-1,cursor:"pointer",desiredSize:new e.Size(8,8),fill:"darkred",stroke:"tomato"}),"linkReshapingTool.handleArchetype":t(e.Shape,"Diamond",{desiredSize:new e.Size(7,7),fill:"lightblue",stroke:"deepskyblue"}),"rotatingTool.handleAngle":270,"rotatingTool.handleDistance":30,"rotatingTool.snapAngleMultiple":15,"rotatingTool.snapAngleEpsilon":15,"undoManager.isEnabled":!0});var o=t(e.Adornment,"Auto",t(e.Shape,{fill:null,stroke:"deepskyblue",strokeWidth:1.5,strokeDashArray:[4,2]}),t(e.Placeholder)),r=t(e.Adornment,"Spot",{locationSpot:e.Spot.Right},t(e.Placeholder),t(e.Shape,{alignment:e.Spot.TopLeft,cursor:"nw-resize",desiredSize:new e.Size(6,6),fill:"lightblue",stroke:"deepskyblue"}),t(e.Shape,{alignment:e.Spot.Top,cursor:"n-resize",desiredSize:new e.Size(6,6),fill:"lightblue",stroke:"deepskyblue"}),t(e.Shape,{alignment:e.Spot.TopRight,cursor:"ne-resize",desiredSize:new e.Size(6,6),fill:"lightblue",stroke:"deepskyblue"}),t(e.Shape,{alignment:e.Spot.Left,cursor:"w-resize",desiredSize:new e.Size(6,6),fill:"lightblue",stroke:"deepskyblue"}),t(e.Shape,{alignment:e.Spot.Right,cursor:"e-resize",desiredSize:new e.Size(6,6),fill:"lightblue",stroke:"deepskyblue"}),t(e.Shape,{alignment:e.Spot.BottomLeft,cursor:"se-resize",desiredSize:new e.Size(6,6),fill:"lightblue",stroke:"deepskyblue"}),t(e.Shape,{alignment:e.Spot.Bottom,cursor:"s-resize",desiredSize:new e.Size(6,6),fill:"lightblue",stroke:"deepskyblue"}),t(e.Shape,{alignment:e.Spot.BottomRight,cursor:"sw-resize",desiredSize:new e.Size(6,6),fill:"lightblue",stroke:"deepskyblue"})),n=t(e.Adornment,{locationSpot:e.Spot.Center,locationObjectName:"CIRCLE"},t(e.Shape,"Circle",{name:"CIRCLE",cursor:"pointer",desiredSize:new e.Size(7,7),fill:"lightblue",stroke:"deepskyblue"}),t(e.Shape,{geometryString:"M3.5 7 L3.5 30",isGeometryPositioned:!0,stroke:"deepskyblue",strokeWidth:1.5,strokeDashArray:[4,2]}));function s(e,t){e.ports.each(function(e){""!==e.portId&&(e.fill=t?"rgba(0,0,0,.3)":null)})}this.myDiagram.nodeTemplate=t(e.Node,"Spot",{locationSpot:e.Spot.Center},new e.Binding("location","loc",e.Point.parse).makeTwoWay(e.Point.stringify),{selectable:!0,selectionAdornmentTemplate:o},{resizable:!0,resizeObjectName:"PANEL",resizeAdornmentTemplate:r},{rotatable:!0,rotateAdornmentTemplate:n},new e.Binding("angle").makeTwoWay(),t(e.Panel,"Auto",{name:"PANEL"},new e.Binding("desiredSize","size",e.Size.parse).makeTwoWay(e.Size.stringify),t(e.Shape,"Rectangle",{portId:"",fromLinkable:!0,toLinkable:!0,cursor:"pointer",fill:"white",strokeWidth:2},new e.Binding("figure"),new e.Binding("fill")),t(e.TextBlock,{font:"bold 11pt Helvetica, Arial, sans-serif",margin:8,maxSize:new e.Size(160,NaN),wrap:e.TextBlock.WrapFit,editable:!0},new e.Binding("text").makeTwoWay())),i("T",e.Spot.Top,!1,!0),i("L",e.Spot.Left,!0,!0),i("R",e.Spot.Right,!0,!0),i("B",e.Spot.Bottom,!0,!1),{mouseEnter:function(e,t){s(t,!0)},mouseLeave:function(e,t){s(t,!1)}});var a=t(e.Adornment,"Link",t(e.Shape,{isPanelMain:!0,fill:null,stroke:"deepskyblue",strokeWidth:0}));this.myDiagram.linkTemplate=t(e.Link,{selectable:!0,selectionAdornmentTemplate:a},{relinkableFrom:!0,relinkableTo:!0,reshapable:!0},{routing:e.Link.AvoidsNodes,curve:e.Link.JumpOver,corner:0,toShortLength:4},new e.Binding("points").makeTwoWay(),t(e.Shape,{isPanelMain:!0,strokeWidth:2}),t(e.Shape,{toArrow:"Standard",stroke:null}),t(e.Panel,"Auto",new e.Binding("visible","isSelected").ofObject(),t(e.Shape,"RoundedRectangle",{fill:"#F8F8F8",stroke:null}),t(e.TextBlock,{textAlign:"center",font:"10pt helvetica, arial, sans-serif",stroke:"#919191",margin:2,minSize:new e.Size(10,NaN),editable:!0},new e.Binding("text").makeTwoWay())));t(e.Palette,"myPaletteDiv",{maxSelectionCount:1,nodeTemplateMap:this.myDiagram.nodeTemplateMap,linkTemplate:t(e.Link,{locationSpot:e.Spot.Center,selectionAdornmentTemplate:t(e.Adornment,"Link",{locationSpot:e.Spot.Center},t(e.Shape,{isPanelMain:!0,fill:null,stroke:"deepskyblue",strokeWidth:0}),t(e.Shape,{toArrow:"Standard",stroke:null}))},{routing:e.Link.AvoidsNodes,curve:e.Link.JumpOver,corner:5,toShortLength:4},new e.Binding("points"),t(e.Shape,{isPanelMain:!0,strokeWidth:2}),t(e.Shape,{toArrow:"Standard",stroke:null})),model:new e.GraphLinksModel([{text:"结构体建模",size:"100 50",figure:"subtask"},{text:"电路建模",size:"100 50",figure:"subtask"},{text:"装配仿真",size:"100 50",figure:"subtask"},{text:"结构仿真",size:"100 50",figure:"subtask"},{text:"电路仿真",size:"100 50",figure:"subtask"},{text:"力学仿真",size:"100 50",figure:"subtask"},{text:"热学仿真",size:"100 50",figure:"subtask"},{text:"热仿真",size:"100 50",figure:"subtask"},{text:"电磁仿真",size:"100 50",figure:"subtask"},{text:"???",figure:"Diamond",fill:"lightskyblue"}],[{points:(new e.List).addAll([new e.Point(0,0),new e.Point(30,0),new e.Point(30,40),new e.Point(60,40)])}])})},saveMyDiagram:function(){console.log(this.myDiagram.model.Gc),console.log(this.myDiagram.model.Pc)},undoMyDiagram:function(){this.myDiagram.commandHandler.undo()},redoMyDiagram:function(){this.myDiagram.commandHandler.redo()},createFromTemp:function(){var e=this,t=[],i=this.myDiagram.model.Gc,o=this.myDiagram.model.Pc;if(i.length<2||o.length<1)this.$notify({title:"提示",message:"当前流程不完整，请检查！",type:"error",duration:2e3});else{for(var s=0;s<i.length;s++){for(var a=!1,l=0;l<o.length;l++){if(!o[l].to||!o[l].from)return void this.$notify({title:"提示",message:"节点未闭合，请检查！",type:"error",duration:2e3});if(-1==i.findIndex(function(e){return e.text.indexOf("建模")>=0})||-1==i.findIndex(function(e){return e.text.indexOf("仿真")>=0}))return void this.$notify({title:"提示",message:"必须至少包含一个建模和仿真流程",type:"error",duration:2e3});for(var d=1;d<o.length;d++)if(l!==d&&(o[l].to===o[d].from&&o[l].from===o[d].to||o[l].to===o[d].to&&o[l].from===o[d].from))return void this.$notify({title:"提示",message:"节点间引用错误，请检查！",type:"error",duration:2e3});o[l].origin=!1;for(var p=0;p<this.originLink.length;p++)if(o[l].to==this.originLink[p].to&&o[l].from==this.originLink[p].from){o[l].origin=!0;break}i[s].key===o[l].to&&(a=!0,!1===o[l].origin?i[s].subtask?t.push({nodeName:i[s].text,location:i[s].loc,selfSign:i[s].key,figure:i[s].figure?i[s].figure:"NULL",nodeSize:i[s].size?i[s].size:"150 70",subtaskId:i[s].subtask?i[s].subtask.id:null,parentSign:o[l].from,toPort:o[l].toPort?o[l].toPort:"NULL",fromPort:o[l].fromPort?o[l].fromPort:"NULL",ifNew:!0}):t.push({nodeName:i[s].text,location:i[s].loc,selfSign:i[s].key,figure:i[s].figure?i[s].figure:"NULL",nodeSize:i[s].size?i[s].size:"150 70",subtaskId:null,parentSign:o[l].from,toPort:o[l].toPort?o[l].toPort:"NULL",fromPort:o[l].fromPort?o[l].fromPort:"NULL",ifNew:!0}):!0===o[l].origin&&t.push({nodeName:i[s].text,location:i[s].loc,selfSign:i[s].key,figure:i[s].figure?i[s].figure:"NULL",nodeSize:i[s].size?i[s].size:"150 70",subtaskId:i[s].subtask?i[s].subtask.id:null,parentSign:o[l].from,toPort:o[l].toPort?o[l].toPort:"NULL",fromPort:o[l].fromPort?o[l].fromPort:"NULL",ifNew:!1}))}if(!a){if(i[s].text.indexOf("建模")<0)return void this.$notify({title:"提示",message:"初始流程必须为建模！",type:"error",duration:2e3});t.push({nodeName:i[s].text,location:i[s].loc,selfSign:i[s].key,figure:i[s].figure?i[s].figure:"NULL",nodeSize:i[s].size?i[s].size:"150 70",subtaskId:i[s].subtask?i[s].subtask.id:null,parentSign:"NULL",toPort:"NULL",fromPort:"NULL",ifNew:!i[s].subtask})}}console.log(t);var u=r()(t);Object(n.d)(this.proId,u).then(function(t){0===t.data.code?(e.$notify({title:"成功",message:"流程创建成功",type:"success",duration:2e3}),e.$emit("refreshList")):e.$notify({title:"失败",message:t.data.msg,type:"error",duration:2e3}),e.$emit("hideVisio")}).catch(function(){e.$notify({title:"失败",message:"操作失败",type:"error",duration:2e3}),e.$emit("hideVisio")})}}},mounted:function(){if(0===this.processNodes.length)this.init(),this.myDiagram.model=this.go.Model.fromJson(this.originValue),this.originLink=this.originValue.linkDataArray.slice();else{for(var e=[],t=[],i={},o=0;o<this.processNodes.length;o++){if(!i[this.processNodes[o].selfSign]){var r={figure:this.processNodes[o].figure,key:this.processNodes[o].selfSign,loc:this.processNodes[o].location,size:this.processNodes[o].nodeSize,text:this.processNodes[o].nodeName,subtask:this.processNodes[o].subtask};!0===this.processNodes[o].subtask.ifApprove&&(r.fill="#2ac06d",r.pass=!0),e.push(r),i[this.processNodes[o].selfSign]=!0}if(this.processNodes[o].parentSign){var n={from:this.processNodes[o].parentSign,to:this.processNodes[o].selfSign,toPort:this.processNodes[o].toPort,fromPort:this.processNodes[o].fromPort,points:[]};!0===this.processNodes[o].subtask.ifApprove&&(n.pass=!0),t.push(n)}}this.originValue.nodeDataArray=e.slice(),this.originValue.linkDataArray=t.slice(),this.originLink=t.slice(),console.log(t),this.init(),this.myDiagram.model=this.go.Model.fromJson(this.originValue)}},destroyed:function(){console.log("destroyed")}},a={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticStyle:{height:"100%"},attrs:{id:"sample"}},[e.editable?i("div",{staticClass:"operationBar",staticStyle:{"margin-bottom":"10px"}},[i("span",{staticClass:"operation-btn",on:{click:e.saveMyDiagram}},[e._v("保存")]),e._v(" "),i("span",{staticClass:"operation-btn",on:{click:e.undoMyDiagram}},[e._v("撤销")]),e._v(" "),i("span",{staticClass:"operation-btn",on:{click:e.redoMyDiagram}},[e._v("恢复")]),e._v(" "),i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.createFromTemp}},[e._v("保存")])],1):e._e(),e._v(" "),i("div",{staticStyle:{width:"100%",display:"flex","justify-content":"space-between",height:"calc(100% - 40px)"}},[i("div",{class:{hide:!1===e.editable},staticStyle:{width:"200px","margin-right":"2px","background-color":"whitesmoke",border:"solid 1px black"},attrs:{id:"myPaletteDiv"}}),e._v(" "),i("div",{staticStyle:{"flex-grow":"1",height:"100%",border:"solid 1px black"},attrs:{id:"myDiagramDiv"}})]),e._v(" "),i("div",{attrs:{id:"myOverviewDIV"}})])},staticRenderFns:[]};var l=i("VU/8")(s,a,!1,function(e){i("D7AG")},"data-v-1da997fa",null);t.default=l.exports},D7AG:function(e,t,i){var o=i("pvpj");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);i("rjj0")("0d2c2c84",o,!0)},pvpj:function(e,t,i){(e.exports=i("FZ+f")(!1)).push([e.i,"\n.hide[data-v-1da997fa] {\n  display: none;\n}\n",""])}});